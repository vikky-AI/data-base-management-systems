# data-base-management-systems
retrival of specific quires from inbuilt datasets

************************************************************************************************
** ABOUT: SQl language                                                                        **
**   SQL: stands for Structured Query Language                                                **
**   SQL: lets you access and manipulate databases                                            **
**   SQL: became a standard of the American National Standards Institute (ANSI) in 1986       ** 
**   SQL: can execute queries against a database                                              **
**   SQL: can retrieve data from a database                                                   **
**   SQL: can insert records in a database                                                    **
**   SQL: can update records in a database                                                    **
**   SQL: can delete records from a database                                                  **
**   SQL: can create new databases                                                            **
**   SQL: can create new tables in a database                                                 **
**   SQL: can create stored procedures in a database                                          **
**   SQL: can create views in a database                                                      **
**   SQL: can set permissions on tables, procedures, and views                                **
***********************************************************************************************/

########################## PROBLEM 1 ##########################
# a) List all customers that live in the Nepal

USE sakila;
SELECT 
    customer_id, first_name, last_name, address_id
FROM
    customer
WHERE
    address_id IN (SELECT 
            address_id
        FROM
            address
        WHERE
            city_id IN (SELECT 
                    city_id
                FROM
                    city
                WHERE
                    country_id = (SELECT 
                            country_id
                        FROM
                            country
                        WHERE
                            country = 'NEPAL')));

# b) List all actors that appear in the movie titled Academy Dinosaur.
SELECT 
    actor_id, first_name, last_name
FROM
    actor
WHERE
    actor_id IN ((SELECT DISTINCT
            actor_id
        FROM
            film_actor
        WHERE
            film_id = '1'));
    
    

# c) What is the revenue generated by each employee ?
#assuming it to be customer
SELECT 
    payment.customer_id,
    SUM(amount),
    COUNT(customer_id),
    ((SUM(amount)) / (COUNT(customer_id))) AS revneach
FROM
    payment
GROUP BY customer_id;

              # d) List top 10 customers that rented the most movies.
# REPCUSTMERS STANDS FOR NO OF TIMES EACH ONE RENTED

SELECT 
    customer.customer_id,
    customer.first_name,
    customer.last_name
FROM
    customer
        INNER JOIN
    rental ON customer.customer_id = rental.customer_id
GROUP BY customer_id
ORDER BY COUNT(*) DESC
LIMIT 10;


# e) List the inventory available in store to rent for each of the movies

        
        SELECT DISTINCT
    store_id, inventory_id, film_id
FROM
    inventory
GROUP BY film_id
ORDER BY store_id;
	


# f) List the top zipcodes that have the highest rental activity



SELECT 
    address.postal_code,
    address.address_id,
    customer.customer_id
FROM
    address
        INNER JOIN
    customer ON address.address_id = customer.address_id
        INNER JOIN
    rental ON customer.customer_id = rental.customer_id
GROUP BY customer_id
ORDER BY COUNT(*) DESC;


########################## PROBLEM 2 ##########################
# Note: For questions a, b, c below use a single query with a sub query
# a) List actors and customers whose first name is the same as the first name of the actor with ID 8
# assuming it as to show actor with id= 8 following answer is constructed
SELECT 
    customer.first_name,
    customer.customer_id,
    actor.actor_id,
    actor.first_name
FROM
    customer
        INNER JOIN
    actor ON customer.first_name = actor.first_name
        AND (actor_id = 8);

# b) List customers and payment amounts, with payments greater than average payment amount
SELECT 
    payment.amount,
    customer.first_name,
    payment.customer_id,
    customer.last_name
FROM
    payment
        INNER JOIN
    customer ON payment.customer_id = customer.customer_id
WHERE
    amount > (SELECT 
            AVG(amount)
        FROM
            payment);
# if we want distinct customers who made payment greater than average
SELECT 
    payment.amount,
    customer.first_name,
    payment.customer_id,
    customer.last_name
FROM
    payment
        INNER JOIN
    customer ON payment.customer_id = customer.customer_id
WHERE
    amount > (SELECT 
            AVG(amount)
        FROM
            payment)
GROUP BY customer_id;


# c) List customers who have rented movies at least once
SELECT 
    customer_id, first_name, last_name
FROM
    customer
WHERE
    customer_id IN (SELECT 
            customer_id
        FROM
            rental);


# Note: use IN clause with the sub query
# d) Find the floor of the maximum, minimum and average payment amount
SELECT 
    FLOOR(AVG(amount)) AS avgp,
    FLOOR(MIN(amount)) AS minpm,
    FLOOR(MAX(amount)) AS maxpm
FROM
    payment;


########################## PROBLEM 3 ##########################
# a) Create a view called actors_portfolio which contains information about actors
# and films ( including titles and category).
DROP VIEW IF EXISTS actors_portofilo;
CREATE VIEW actors_portofilo AS
    SELECT 
        actor.last_name,
        actor.first_name,
        actor.actor_id,
        film.title,
        film.description
    FROM
        actor
            INNER JOIN
        film_actor ON actor.actor_id = film_actor.actor_id
            INNER JOIN
        film ON film_actor.film_id = film.film_id
    GROUP BY actor_id;
        
        
SELECT 
    *
FROM
    actors_portofilo;
        
        
        
# b) Describe the structure of the view and query the view to get information on the actor ADAM GRANT
DESCRIBE actors_portofilo;

SELECT 
       last_name,
        first_name,
        actor_id,
        title,
        description
FROM
     actors_portofilo
     WHERE 
     first_name = 'ADAM'
     AND 
     last_name = 'GRANT'
     ;
# c) Insert a new movie titled Data Hero in Sci-Fi Category starring ADAM GRANT
# Note: If you see an error, explain why this is not permitted
SET SQL_SAFE_UPDATES = 0;
UPDATE actors_portofilo 
SET 
    title = 'Data Hero',
    first_name = 'ADAM ',
    last_name = 'GRANT'
WHERE
    film_id = 201;
/*****************************************************************************************************
* error 1288 : The target table is not updatable                                                     *
* For a view to be updatable, there must be a one-to-one relationship between the rows in the view   *
* and the rows in the underlying table.                                                              *
* but in this case the view to be updated( actots_portofilo) has one to many relation ship with rows *
* of 'movie' or data to be inserted                                                                  *
* **************************one actor can do many films*************************                     *
*     and  also there complex inner join in view which makes it not permittable                      *
*****************************************************************************************************/
########################## PROBLEM 4 (Optional) ##########################
# a) Extract the street number ( characters 1 through 4 ) from customer addressLine1
SELECT 
    SUBSTRING(customer.address, 1, 4),
    address.first_name,
    address.last_name
FROM
    address customer
        INNER JOIN
    customer address ON customer.address_id = address.address_id;
# b) Find out actors whose last name starts with character A, B or C.
SELECT 
    *
FROM
    actor
WHERE
    last_name REGEXP '^(A|B|C)';
# c) Find film titles that contains exactly 10 characters
SELECT 
    title
FROM
    film
WHERE
    title REGEXP '^.{10}$'; 
# d) Format a payment_date using the following format e.g "22/1/2016"
SELECT 
    DATE_FORMAT(payment_date, '%d/%m/%Y') AS payemt_date
FROM
    payment;
# e) Find the number of days between two date values rental_date & return_date
SELECT 
    rental_date, return_date, DATEDIFF(return_date, rental_date)
FROM
    rental;
    
   #################################### QUESTION 1 ################################
# a) Show the list of databases.
	 SHOW DATABASES;
# b) Select sakila database.
	 USE sakila ;
# c) Show all tables in the sakila database.
     SHOW TABLES;
# d) Show each of the columns along with their data types for the actor table.
     DESCRIBE actor;
# e) Show the total number of records in the actor table.
     SELECT 
    COUNT(*)
FROM
    actor;
# f) What is the first name and last name of all the actors in the actor table ?
     SELECT 
    last_name, first_name
FROM
    actor;

# g) Insert your first name and middle initial ( in the last name column ) into the actors table.

# there is no table defined with name "actors" in sakila dataset, assuming it to be "actor" table following answer is done
# THE NAMES FICTIOUS PLEASE NOT THAT

	INSERT INTO `actor` (`first_name`,`last_name`,`actor_id`,`last_update`)
		VALUES ('divya','divya.l.acct','201','2006-02-15 04:34:33');
# to check we can use below statement
SELECT 
    *
FROM
    actor;
    
  
